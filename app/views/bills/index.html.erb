<div class="container max_924">

<%= render 'bills/top_banner_with_names' %>
<h2>TOP TRENDING BILLS</h2>

	<div class="row trending_bills" >
		<% 
			if @trending.any?
			@trending.each do |bill|

			@vote = current_user.votes.where(bill_id: bill.id).first
			@for = false
			@against = false
			if @vote && @vote.in_favor
				@for = true
			end
			if @vote
				unless @vote.in_favor
					@against = true
				end
			end
			
			#https://css-tricks.com/centering-in-the-unknown/
		 %>
		<div class="col-md-12 text-center" style="padding-bottom: 50px;">
			<div class="row" style="padding-bottom:20px;">
			    <% if bill.image_url %>
			    	<div class="col-md-12" id="main-bill" style="background-image: url('https:<%= bill.image_url %>');padding: 0px;">
			    <% else %>
					<div class="col-md-12" id="main-bill" style="background-image: image-url(/assets/bill-standard-background.jpg);padding: 0px;">
				<% end %>
					<div style="background-color: rgba(12, 11, 11, 0.24);height: 100%;width: 100%;">
						<table style="width:100%;height:100%;">
						  <tr>
							 <td style="text-align: center; vertical-align: middle;">
								<h1><%= link_to bill.simple_name, bill_path(bill) %></h1>
								<h3><%= link_to bill.official_name, bill_path(bill) %></h3>
							 </td>
						  </tr>
						</table>
					</div>
				</div>
			</div>


			<div class="row" style="margin-bottom: 20px;">
				<div class="col-sm-6 main-bill-arguments  arguments-left">
					<div class="panel panel-bills-slider">
						<div class="panel-body">
							<h2 class="header-argument-for text-center">ARGUMENT FOR</h2>
							<div class="text-left">
								<%= bill.support.html_safe %>
							</div>
						</div>
					</div><!--.panel -->
					<div class="vote-button-yes">
						<%= render :partial => 'bills/vote_yes_form', :locals => { :bill => bill.id, :favor => @for } %>
					</div>
				</div>
				<div class="col-sm-6 main-bill-arguments arguments-right">
					<div class="panel panel-bills-slider">
						<div class="panel-body">
							<h2 class="header-argument-against text-center">ARGUMENT AGAINST</h2>
							<div class="text-left">
								<%= bill.opposition.html_safe %>
							</div>
						</div>
					</div><!--.panel -->
					<div class="vote-button-no">
						<%= render :partial => 'bills/vote_no_form', :locals => { :bill => bill.id, :against => @against } %>
					</div>

				</div>
			</div>

		</div>
		<% end %>
		<% end %>
	</div>



<div style="padding-bottom:60px;">

	<% 
		if @common.any?
		_index = 0
		# @common.each do |bill|
		@common.each_with_index do |bill, index|

		@vote = current_user.votes.where(bill_id: bill.id).first
		@for = false
		@against = false
		if @vote && @vote.in_favor
			@for = true
		end
		if @vote
			unless @vote.in_favor
				@against = true
			end
		end

		_index = index
		if index % 2 == 0
			_align = "arguments-left"
			%>
				<div class="row">

			<%
		else 
			_align = "arguments-right"
		end
	 %>
	<div class="col-sm-6 <%= _align %> text-center">
		<div class="panel panel-bills">
			<div class="panel-body">
				<div class="row" style="padding:20px;">
					<% if bill.image_url %>
				    	<div class="col-md-12 common-bill" style="background-image: url('https:<%= bill.image_url %>')">
				    <% else %>
						<div class="col-md-12 common-bill" style="background-image: image-url(/assets/bill-standard-background.jpg)">
					<% end %>
						<table style="width:100%;height:100%;">
						  <tr>
							 <td style="text-align: center; vertical-align: middle;">
								<p class="common-bill-title text-uppercase"><%= link_to bill.simple_name, bill_path(bill) %></p>
								<p class="common-bill-title text-uppercase"><small><%= link_to bill.official_name, bill_path(bill) %></small></p>
							 </td>
						  </tr>
						</table>
					</div>
				</div>


				<div class="row" style="margin: 0 5px 20px 5px;padding: 0 5px;">
					<div class="col-md-12 text-center text-din" style="padding-bottom:22px;border-bottom: 1px solid #a1a1a1; ">
						<h2 class="header-argument-for">ARGUMENT FOR</h2>
						<%= bill.support.html_safe %>
					</div>
					<div class="col-md-12 text-center text-din" style="padding-bottom:22px;border-bottom: 1px solid #a1a1a1; ">
						<h2 class="header-argument-against">ARGUMENT AGAINST</h2>
						<%= bill.opposition.html_safe %>
					</div>
				</div>


				<div class="row" style="margin: 0 5px 10px 5px;padding: 0 5px;">
					<div class="col-sm-6 vote-button-yes">
						<% if user_signed_in? %>
							<%= render :partial => 'bills/vote_yes_form', :locals => { :bill => bill.id, :favor => @for } %>
						<% else %>
							<a class="navbar-brand" href="#" data-toggle="modal" data-target="#loginModal">SIGN IN</a>
						<% end %>
					</div>
					<div class="col-sm-6 vote-button-no">
						<% if user_signed_in? %>
							<%= render :partial => 'bills/vote_no_form', :locals => { :bill => bill.id, :against => @against } %>
						<% else %>
							<a class="navbar-brand" href="#" data-toggle="modal" data-target="#loginModal">SIGN IN</a>
						<% end %>
					</div>
				</div>
			</div><!--.panel-body-->
		</div><!--.panel-->

		</div><!-- .col-sm-6 -->
		<% 
			if index % 2 != 0 
				%></div><%
			end
		end
		
		if _index % 2 != 0 
				%></div><%
		end
			
		%>

	<% end %>
</div>

</div><!-- .row .trending_bills -->

</div> <!--.container max_924 -->

<script type="text/javascript">
var ready;
ready = function() {

	  $('.trending_bills').slick({
	    accessibility: true,

	  });

	  $('body').off('click','.bill_voting');
	  $('body').on('click','.bill_voting', function(e){
	  	e.preventDefault();

	  	var this_form = $(this);
	  	var comment_section = $(this_form).children('.hidden_comment');

	  	if ( this_form.hasClass('vote_yes') ) {
	  		//$('#commentModal').addClass('modal-whip-vote-yes');
	  		$('#myModalLabelVote').html('<span class="text-vote-yes">VOTED FOR</span>');
	  	} else {
	  		//$('#commentModal').addClass('modal-whip-vote-no');
	  		$('#myModalLabelVote').html('<span class="text-vote-no">VOTED AGAINST</span>');
	  	}

	  	comment_section.val('testing');
	  	
	  	$('#commentModal').modal('show');

	  	$('#commentModal').on('hide.bs.modal', function(e){
	  		var comment_modal = $(this);
	  		var new_comment = $(comment_modal).find('#content').val();
	  		comment_section.val(new_comment);
	  		
	  		this_form.trigger("submit.rails");
	  	});

	  	// Need to rework this still
	  	// so far creates modal when vote btn is clicked
	  	// and submits vote on closing of modal
	  	// need to add right facing triangle action btn to 'submit' vote
	  	// this will actually just hide comment box and text at top of modal
	  	// actual submission happens on close of modal
	  	// also need to have social share icons slide up / center in modal after other stuff is hidden

	  	
	  	$('#commentModal').off('click','#add_comment');
	  	$('#commentModal').on('click','#add_comment',function(e){
	  		var new_comment = $(this).siblings('#content').val();
	  		comment_section.val(new_comment);
	  		$('#vote-modal-comment').hide();
	  		$('#vote-modal-social').fadeIn();
	  		//$('#commentModal').modal('hide');
	  		//this_form.trigger("submit.rails");
	  	});
	  	

	  });



};

$(document).ready(ready);
$(document).on('page:load', ready);
</script>